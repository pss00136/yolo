<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="club">

<!-- club 등록 sql -->
<insert id = "clubInsert" parameterType="yolo.club.dto.ClubVO">
	INSERT INTO CLUB 
	VALUES( concat('c_', CLUB_NO_SEQ.nextval), #{u_id}, #{c_type}, #{c_title}, #{c_tag}, #{c_people}, #{c_recruit}, #{c_period}, #{c_date}, #{c_place}, #{c_content}, 'n', sysdate, 0 , 0)
</insert>
<insert id = "clubimgInsert" parameterType="yolo.club.dto.ClubImageVO">
	<selectKey keyColumn="c_num" keyProperty="c_num" order="BEFORE" resultType='string'>
         SELECT concat('c_',CLUB_NO_SEQ.currval) FROM dual
	</selectKey>
	INSERT INTO CLUBIMAGE (CIMG_NUM , C_NUM , CIMG_PATH , CIMG_NAME) 
	VALUES(concat('cimg_', CLUBIMAGE_NO_SEQ.nextval), #{c_num}, #{cimg_path}, #{cimg_name})
</insert>

<!-- club 예약한 공간 list 출력 -->
<select id="clubinputList" parameterType="string" resultType="yolo.share.dto.InputListVO">
 SELECT B.BL_DATE B_DATE, B.BL_ID BL_ID, P.PRI_NUM PRI_NUM, P.PRI_TITLE PRI_TITLE, I.PRIIMG_NAME PRIIMG_NAME, P.PRI_ADDR PRI_ADDR 
FROM PRIVATELOT P, BOOKLOT B, PRIVATEIMAGE I
WHERE P.PRI_NUM = B.PRI_NUM AND I.PRI_NUM = P.PRI_NUM AND B.U_ID = #{user}
</select>

<!-- club List 출력 sql -->
<select id = "clublistview" resultType="yolo.club.dto.ClubListVO">
	SELECT C.C_NUM C_NUM, I.CIMG_NAME CIMG_NAME, C.C_TYPE C_TYPE, C.C_TITLE C_TITLE, C.c_people c_people, C.C_PERIOD C_PERIOD, C.C_DATE C_DATE, C.C_PLACE C_PLACE
	FROM CLUB C JOIN CLUBIMAGE I
	ON c.c_num = i.c_num
</select>

<!-- club keyword Search 출력 sql -->
<select id = "clubsearhKey" parameterType="hashmap" resultType="yolo.club.dto.ClubListVO">
	SELECT C.C_NUM C_NUM, I.CIMG_NAME CIMG_NAME, C.C_TYPE C_TYPE, C.C_TITLE C_TITLE, C.c_people c_people, C.C_PERIOD C_PERIOD, C.C_DATE C_DATE, C.C_PLACE C_PLACE
	FROM CLUB C JOIN CLUBIMAGE I
	ON c.c_num = i.c_num
 	WHERE C.C_TYPE like #{keyWord}
</select>

<!-- club location Search 출력 sql -->
<select id = "clubsearhLoc" parameterType="hashmap" resultType="yolo.club.dto.ClubListVO">
	SELECT C.C_NUM C_NUM, I.CIMG_NAME CIMG_NAME, C.C_TYPE C_TYPE, C.C_TITLE C_TITLE, C.c_people c_people, C.C_PERIOD C_PERIOD, C.C_DATE C_DATE, C.C_PLACE C_PLACE
	FROM CLUB C JOIN CLUBIMAGE I
	ON c.c_num = i.c_num
 	WHERE 
	<foreach collection="locations" item="one" index="index" open="(" close=")" separator="or">
		C.C_PLACE like #{one} ||'%'
	</foreach>
	
</select>

<!-- club Detail view 출력 sql -->
<select id="clubdetail" parameterType="yolo.club.dto.ClubListVO" resultType="yolo.club.dto.ClubListVO">
	SELECT C.C_NUM C_NUM, C.U_ID U_ID, I.CIMG_NAME CIMG_NAME, C.C_TYPE C_TYPE, C.C_TITLE C_TITLE, C.C_TAG C_TAG, C.C_PEOPLE C_PEOPLE, C.C_RECRUIT C_RECRUIT, C.C_PERIOD C_PERIOD, C.C_DATE C_DATE, C.C_PLACE C_PLACE, 
    C.C_CONTENT C_CONTENT, C.C_REGDATE C_REGDATE	
    FROM CLUB C JOIN CLUBIMAGE I
	ON c.c_num = i.c_num
	WHERE C.C_NUM = #{c_num}
</select>




</mapper>